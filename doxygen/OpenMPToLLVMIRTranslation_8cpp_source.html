<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLIR: lib/Target/LLVMIR/Dialect/OpenMP/OpenMPToLLVMIRTranslation.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MLIR
   &#160;<span id="projectnumber">13.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_12a96bdcc885ecacc799866a8efa56d5.html">LLVMIR</a></li><li class="navelem"><a class="el" href="dir_38c1dda222e2fa1f8060eb14e2940f7d.html">Dialect</a></li><li class="navelem"><a class="el" href="dir_d09a340c4a749dcbe74b34243f5130f5.html">OpenMP</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">OpenMPToLLVMIRTranslation.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="OpenMPToLLVMIRTranslation_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- OpenMPToLLVMIRTranslation.cpp - Translate OpenMP dialect to LLVM IR-===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This file implements a translation between the MLIR OpenMP dialect and LLVM</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// IR.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OpenMPToLLVMIRTranslation_8h.html">mlir/Target/LLVMIR/Dialect/OpenMP/OpenMPToLLVMIRTranslation.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OpenMPDialect_8h.html">mlir/Dialect/OpenMP/OpenMPDialect.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operation_8h.html">mlir/IR/Operation.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVM_8h.html">mlir/Support/LLVM.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ModuleTranslation_8h.html">mlir/Target/LLVMIR/ModuleTranslation.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;llvm/ADT/SetVector.h&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;llvm/ADT/TypeSwitch.h&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;llvm/Frontend/OpenMP/OMPIRBuilder.h&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;llvm/IR/IRBuilder.h&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacemlir.html">mlir</a>;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/// Converts the given region that appears within an OpenMP dialect operation to</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/// LLVM IR, creating a branch from the `sourceBlock` to the entry block of the</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/// region, and a branch from any block with an successor-less OpenMP terminator</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/// to `continuationBlock`.</span></div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="OpenMPToLLVMIRTranslation_8cpp.html#adbeb98f08f15ccd391192872751ed65f">   30</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#adbeb98f08f15ccd391192872751ed65f">convertOmpOpRegions</a>(<a class="code" href="classmlir_1_1Region.html">Region</a> &amp;region, StringRef blockName,</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                llvm::BasicBlock &amp;sourceBlock,</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                llvm::BasicBlock &amp;continuationBlock,</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                                llvm::IRBuilderBase &amp;builder,</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                                <a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html">LLVM::ModuleTranslation</a> &amp;moduleTranslation,</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a> &amp;bodyGenStatus) {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  llvm::LLVMContext &amp;llvmContext = builder.getContext();</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classmlir_1_1Block.html">Block</a> &amp;bb : region) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    llvm::BasicBlock *llvmBB = llvm::BasicBlock::Create(</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        llvmContext, blockName, builder.GetInsertBlock()-&gt;getParent());</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#accf46c19a673ef7b85e73343e9eaff38">mapBlock</a>(&amp;bb, llvmBB);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  llvm::Instruction *sourceTerminator = sourceBlock.getTerminator();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="comment">// Convert blocks one by one in topological order to ensure</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">// defs are converted before uses.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Block *&gt;</a> blocks =</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      <a class="code" href="namespacemlir_1_1LLVM_1_1detail.html#ada0ca08d24a9978d5465be28eba253f0">LLVM::detail::getTopologicallySortedBlocks</a>(region);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classmlir_1_1Block.html">Block</a> *bb : blocks) {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    llvm::BasicBlock *llvmBB = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a51bb831df4cf8bf4b4bf13a1be791701">lookupBlock</a>(bb);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Retarget the branch of the entry block to the entry block of the</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// converted region (regions are single-entry).</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (bb-&gt;isEntryBlock()) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      assert(sourceTerminator-&gt;getNumSuccessors() == 1 &amp;&amp;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;             <span class="stringliteral">&quot;provided entry block has multiple successors&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      assert(sourceTerminator-&gt;getSuccessor(0) == &amp;continuationBlock &amp;&amp;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;             <span class="stringliteral">&quot;ContinuationBlock is not the successor of the entry block&quot;</span>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      sourceTerminator-&gt;setSuccessor(0, llvmBB);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    llvm::IRBuilderBase::InsertPointGuard guard(builder);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">failed</a>(</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a04c2e13596c2bc9d0cfada820eea7358">convertBlock</a>(*bb, bb-&gt;isEntryBlock(), builder))) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      bodyGenStatus = <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// Special handling for `omp.yield` and `omp.terminator` (we may have more</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// than one): they return the control to the parent OpenMP dialect operation</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// so replace them with the branch to the continuation block. We handle this</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// here to avoid relying inter-function communication through the</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// ModuleTranslation class to set up the correct insertion point. This is</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// also consistent with MLIR&#39;s idiom of handling special region terminators</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// in the same code that handles the region-owning operation.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span> (isa&lt;omp::TerminatorOp, omp::YieldOp&gt;(bb-&gt;getTerminator()))</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      builder.CreateBr(&amp;continuationBlock);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// Finally, after all blocks have been traversed and values mapped,</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// connect the PHI nodes to the results of preceding blocks.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="namespacemlir_1_1LLVM_1_1detail.html#a2b966f440106b35eb828bab13414c55b">LLVM::detail::connectPHINodes</a>(region, moduleTranslation);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/// Converts the OpenMP parallel operation to LLVM IR.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a></div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="OpenMPToLLVMIRTranslation_8cpp.html#ab6c3dd7509bd26a6182ff0e8e7138fc9">   85</a></span>&#160;<a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#ab6c3dd7509bd26a6182ff0e8e7138fc9">convertOmpParallel</a>(<a class="code" href="classmlir_1_1Operation.html">Operation</a> &amp;opInst, llvm::IRBuilderBase &amp;builder,</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                   <a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html">LLVM::ModuleTranslation</a> &amp;moduleTranslation) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keyword">using</span> InsertPointTy = llvm::OpenMPIRBuilder::InsertPointTy;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// TODO: support error propagation in OpenMPIRBuilder and use it instead of</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// relying on captured variables.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a> bodyGenStatus = <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keyword">auto</span> bodyGenCB = [&amp;](InsertPointTy allocaIP, InsertPointTy codeGenIP,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                       llvm::BasicBlock &amp;continuationBlock) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// ParallelOp has only one region associated with it.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keyword">auto</span> &amp;region = cast&lt;omp::ParallelOp&gt;(opInst).getRegion();</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#adbeb98f08f15ccd391192872751ed65f">convertOmpOpRegions</a>(region, <span class="stringliteral">&quot;omp.par.region&quot;</span>, *codeGenIP.getBlock(),</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                        continuationBlock, builder, moduleTranslation,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                        bodyGenStatus);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  };</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// TODO: Perform appropriate actions according to the data-sharing</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// attribute (shared, private, firstprivate, ...) of variables.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// Currently defaults to shared.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keyword">auto</span> privCB = [&amp;](InsertPointTy allocaIP, InsertPointTy codeGenIP,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    llvm::Value &amp;, llvm::Value &amp;vPtr,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    llvm::Value *&amp;replacementValue) -&gt; InsertPointTy {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    replacementValue = &amp;vPtr;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">return</span> codeGenIP;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  };</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">// TODO: Perform finalization actions for variables. This has to be</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// called for variables which have destructors/finalizers.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keyword">auto</span> finiCB = [&amp;](InsertPointTy codeGenIP) {};</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  llvm::Value *ifCond = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> ifExprVar = cast&lt;omp::ParallelOp&gt;(opInst).if_expr_var())</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    ifCond = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a077b1182e55dd26f2e921fdce534aa38">lookupValue</a>(ifExprVar);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  llvm::Value *numThreads = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> numThreadsVar = cast&lt;omp::ParallelOp&gt;(opInst).num_threads_var())</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    numThreads = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a077b1182e55dd26f2e921fdce534aa38">lookupValue</a>(numThreadsVar);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  llvm::omp::ProcBindKind pbKind = llvm::omp::OMP_PROC_BIND_default;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> bind = cast&lt;omp::ParallelOp&gt;(opInst).proc_bind_val())</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    pbKind = llvm::omp::getProcBindKind(bind.getValue());</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// TODO: Is the Parallel construct cancellable?</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">bool</span> isCancellable = <span class="keyword">false</span>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// TODO: Determine the actual alloca insertion point, e.g., the function</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// entry or the alloca insertion point as provided by the body callback</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// above.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  llvm::OpenMPIRBuilder::InsertPointTy allocaIP(builder.saveIP());</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">failed</a>(bodyGenStatus))</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  llvm::OpenMPIRBuilder::LocationDescription ompLoc(</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      builder.saveIP(), builder.getCurrentDebugLocation());</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  builder.restoreIP(moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a9f44e072590ad67cc75d240bfa86b936">getOpenMPBuilder</a>()-&gt;createParallel(</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      ompLoc, allocaIP, bodyGenCB, privCB, finiCB, ifCond, numThreads, pbKind,</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      isCancellable));</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">/// Converts an OpenMP &#39;master&#39; operation into LLVM IR using OpenMPIRBuilder.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a></div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="OpenMPToLLVMIRTranslation_8cpp.html#a272457451d2c075defa2344ae9905ea8">  143</a></span>&#160;<a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#a272457451d2c075defa2344ae9905ea8">convertOmpMaster</a>(<a class="code" href="classmlir_1_1Operation.html">Operation</a> &amp;opInst, llvm::IRBuilderBase &amp;builder,</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                 <a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html">LLVM::ModuleTranslation</a> &amp;moduleTranslation) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keyword">using</span> InsertPointTy = llvm::OpenMPIRBuilder::InsertPointTy;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="comment">// TODO: support error propagation in OpenMPIRBuilder and use it instead of</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// relying on captured variables.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a> bodyGenStatus = <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keyword">auto</span> bodyGenCB = [&amp;](InsertPointTy allocaIP, InsertPointTy codeGenIP,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                       llvm::BasicBlock &amp;continuationBlock) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// MasterOp has only one region associated with it.</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keyword">auto</span> &amp;region = cast&lt;omp::MasterOp&gt;(opInst).getRegion();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#adbeb98f08f15ccd391192872751ed65f">convertOmpOpRegions</a>(region, <span class="stringliteral">&quot;omp.master.region&quot;</span>, *codeGenIP.getBlock(),</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        continuationBlock, builder, moduleTranslation,</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        bodyGenStatus);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  };</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">// TODO: Perform finalization actions for variables. This has to be</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// called for variables which have destructors/finalizers.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keyword">auto</span> finiCB = [&amp;](InsertPointTy codeGenIP) {};</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  llvm::OpenMPIRBuilder::LocationDescription ompLoc(</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      builder.saveIP(), builder.getCurrentDebugLocation());</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  builder.restoreIP(moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a9f44e072590ad67cc75d240bfa86b936">getOpenMPBuilder</a>()-&gt;createMaster(</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      ompLoc, bodyGenCB, finiCB));</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">/// Converts an OpenMP workshare loop into LLVM IR using OpenMPIRBuilder.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a></div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="OpenMPToLLVMIRTranslation_8cpp.html#ada3742d4afd1f62523af29edc7828d18">  172</a></span>&#160;<a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#ada3742d4afd1f62523af29edc7828d18">convertOmpWsLoop</a>(<a class="code" href="classmlir_1_1Operation.html">Operation</a> &amp;opInst, llvm::IRBuilderBase &amp;builder,</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                 <a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html">LLVM::ModuleTranslation</a> &amp;moduleTranslation) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keyword">auto</span> loop = cast&lt;omp::WsLoopOp&gt;(opInst);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="comment">// TODO: this should be in the op verifier instead.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">if</span> (loop.lowerBound().empty())</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordflow">if</span> (loop.getNumLoops() != 1)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">return</span> opInst.<a class="code" href="classmlir_1_1Operation.html#af3f6d9c03a24dea8d37c020ad4f6d1af">emitOpError</a>(<span class="stringliteral">&quot;collapsed loops not yet supported&quot;</span>);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordtype">bool</span> isStatic = <span class="keyword">true</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">if</span> (loop.schedule_val().hasValue()) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">auto</span> schedule =</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        omp::symbolizeClauseScheduleKind(loop.schedule_val().getValue());</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span> (schedule != omp::ClauseScheduleKind::Static &amp;&amp;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        schedule != omp::ClauseScheduleKind::Dynamic)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">return</span> opInst.<a class="code" href="classmlir_1_1Operation.html#af3f6d9c03a24dea8d37c020ad4f6d1af">emitOpError</a>(<span class="stringliteral">&quot;only static (default) and dynamic loop &quot;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                <span class="stringliteral">&quot;schedule is currently supported&quot;</span>);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    isStatic = (schedule == omp::ClauseScheduleKind::Static);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// Find the loop configuration.</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  llvm::Value *lowerBound = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a077b1182e55dd26f2e921fdce534aa38">lookupValue</a>(loop.lowerBound()[0]);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  llvm::Value *upperBound = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a077b1182e55dd26f2e921fdce534aa38">lookupValue</a>(loop.upperBound()[0]);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  llvm::Value *step = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a077b1182e55dd26f2e921fdce534aa38">lookupValue</a>(loop.step()[0]);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  llvm::Type *ivType = step-&gt;getType();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  llvm::Value *chunk =</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      loop.schedule_chunk_var()</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          ? moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a077b1182e55dd26f2e921fdce534aa38">lookupValue</a>(loop.schedule_chunk_var())</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          : llvm::ConstantInt::get(ivType, 1);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// Set up the source location value for OpenMP runtime.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  llvm::DISubprogram *subprogram =</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      builder.GetInsertBlock()-&gt;getParent()-&gt;getSubprogram();</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keyword">const</span> llvm::DILocation *diLoc =</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a5eb37753a783d224c0cd751746c1ad54">translateLoc</a>(opInst.<a class="code" href="classmlir_1_1Operation.html#a6c0b8ce5ff714a34f0192f3aa60dc7ea">getLoc</a>(), subprogram);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  llvm::OpenMPIRBuilder::LocationDescription ompLoc(builder.saveIP(),</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                                    llvm::DebugLoc(diLoc));</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// Generator of the canonical loop body. Produces an SESE region of basic</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">// blocks.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// TODO: support error propagation in OpenMPIRBuilder and use it instead of</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">// relying on captured variables.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a> bodyGenStatus = <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keyword">auto</span> bodyGen = [&amp;](llvm::OpenMPIRBuilder::InsertPointTy ip, llvm::Value *iv) {</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    llvm::IRBuilder&lt;&gt;::InsertPointGuard guard(builder);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// Make sure further conversions know about the induction variable.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#af292822b3f890f22fafba471974afa1f">mapValue</a>(loop.getRegion().front().getArgument(0), iv);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    llvm::BasicBlock *entryBlock = ip.getBlock();</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    llvm::BasicBlock *exitBlock =</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        entryBlock-&gt;splitBasicBlock(ip.getPoint(), <span class="stringliteral">&quot;omp.wsloop.exit&quot;</span>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// Convert the body of the loop.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#adbeb98f08f15ccd391192872751ed65f">convertOmpOpRegions</a>(loop.region(), <span class="stringliteral">&quot;omp.wsloop.region&quot;</span>, *entryBlock,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                        *exitBlock, builder, moduleTranslation, bodyGenStatus);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  };</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// Delegate actual loop construction to the OpenMP IRBuilder.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">// TODO: this currently assumes WsLoop is semantically similar to SCF loop,</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">// i.e. it has a positive step, uses signed integer semantics. Reconsider</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">// this code when WsLoop clearly supports more cases.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  llvm::BasicBlock *insertBlock = builder.GetInsertBlock();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  llvm::CanonicalLoopInfo *loopInfo =</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a9f44e072590ad67cc75d240bfa86b936">getOpenMPBuilder</a>()-&gt;createCanonicalLoop(</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;          ompLoc, bodyGen, lowerBound, upperBound, step, <span class="comment">/*IsSigned=*/</span><span class="keyword">true</span>,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;          <span class="comment">/*InclusiveStop=*/</span>loop.inclusive());</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">failed</a>(bodyGenStatus))</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">failure</a>();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// TODO: get the alloca insertion point from the parallel operation builder.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// If we insert the at the top of the current function, they will be passed as</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="comment">// extra arguments into the function the parallel operation builder outlines.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">// Put them at the start of the current block for now.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  llvm::OpenMPIRBuilder::InsertPointTy allocaIP(</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      insertBlock, insertBlock-&gt;getFirstInsertionPt());</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  llvm::OpenMPIRBuilder::InsertPointTy afterIP;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  llvm::OpenMPIRBuilder *ompBuilder = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a9f44e072590ad67cc75d240bfa86b936">getOpenMPBuilder</a>();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span> (isStatic) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    loopInfo = ompBuilder-&gt;createStaticWorkshareLoop(ompLoc, loopInfo, allocaIP,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                                     !loop.nowait(), chunk);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    afterIP = loopInfo-&gt;getAfterIP();</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    afterIP = ompBuilder-&gt;createDynamicWorkshareLoop(ompLoc, loopInfo, allocaIP,</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                                     !loop.nowait(), chunk);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// Continue building IR after the loop.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  builder.restoreIP(afterIP);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">/// Implementation of the dialect interface that converts operations belonging</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">/// to the OpenMP dialect to LLVM IR.</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span><span class="keyword">class </span>OpenMPDialectLLVMIRTranslationInterface</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    : <span class="keyword">public</span> <a class="code" href="classmlir_1_1LLVMTranslationDialectInterface.html">LLVMTranslationDialectInterface</a> {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keyword">using</span> <a class="code" href="classmlir_1_1LLVMTranslationDialectInterface.html#acbe047965f9212727c6737919351cab0">LLVMTranslationDialectInterface::LLVMTranslationDialectInterface</a>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">  /// Translates the given operation to LLVM IR using the provided IR builder</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">  /// and saving the state in `moduleTranslation`.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"></span>  <a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  convertOperation(<a class="code" href="classmlir_1_1Operation.html">Operation</a> *op, llvm::IRBuilderBase &amp;builder,</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                   <a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html">LLVM::ModuleTranslation</a> &amp;moduleTranslation) <span class="keyword">const</span> <span class="keyword">final</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;};</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;} <span class="comment">// end namespace</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">/// Given an OpenMP MLIR operation, create the corresponding LLVM IR</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">/// (including OpenMP runtime calls).</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"></span><a class="code" href="structmlir_1_1LogicalResult.html">LogicalResult</a> OpenMPDialectLLVMIRTranslationInterface::convertOperation(</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="classmlir_1_1Operation.html">Operation</a> *op, llvm::IRBuilderBase &amp;builder,</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html">LLVM::ModuleTranslation</a> &amp;moduleTranslation)<span class="keyword"> const </span>{</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  llvm::OpenMPIRBuilder *ompBuilder = moduleTranslation.<a class="code" href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a9f44e072590ad67cc75d240bfa86b936">getOpenMPBuilder</a>();</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TypeSwitch.html">llvm::TypeSwitch&lt;Operation *, LogicalResult&gt;</a>(op)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      .Case([&amp;](omp::BarrierOp) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        ompBuilder-&gt;createBarrier(builder.saveIP(), llvm::omp::OMPD_barrier);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      })</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      .Case([&amp;](omp::TaskwaitOp) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        ompBuilder-&gt;createTaskwait(builder.saveIP());</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      })</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      .Case([&amp;](omp::TaskyieldOp) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        ompBuilder-&gt;createTaskyield(builder.saveIP());</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      })</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      .Case([&amp;](omp::FlushOp) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="comment">// No support in Openmp runtime function (__kmpc_flush) to accept</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="comment">// the argument list.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="comment">// OpenMP standard states the following:</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="comment">//  &quot;An implementation may implement a flush with a list by ignoring</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="comment">//   the list, and treating it the same as a flush without a list.&quot;</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="comment">// The argument list is discarded so that, flush with a list is treated</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="comment">// same as a flush without a list.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        ompBuilder-&gt;createFlush(builder.saveIP());</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      })</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      .Case([&amp;](omp::ParallelOp) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#ab6c3dd7509bd26a6182ff0e8e7138fc9">convertOmpParallel</a>(*op, builder, moduleTranslation);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      })</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      .Case([&amp;](omp::MasterOp) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#a272457451d2c075defa2344ae9905ea8">convertOmpMaster</a>(*op, builder, moduleTranslation);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      })</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      .Case([&amp;](omp::WsLoopOp) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="OpenMPToLLVMIRTranslation_8cpp.html#ada3742d4afd1f62523af29edc7828d18">convertOmpWsLoop</a>(*op, builder, moduleTranslation);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      })</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      .Case&lt;omp::YieldOp, omp::TerminatorOp&gt;([](<span class="keyword">auto</span> op) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">// `yield` and `terminator` can be just omitted. The block structure was</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">// created in the function that handles their parent operation.</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        assert(op-&gt;<a class="code" href="classmlir_1_1Operation.html#a80db2165a86e0837b30f5f3e0dc899df">getNumOperands</a>() == 0 &amp;&amp;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;               <span class="stringliteral">&quot;unexpected OpenMP terminator with operands&quot;</span>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">success</a>();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      })</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      .Default([&amp;](<a class="code" href="classmlir_1_1Operation.html">Operation</a> *inst) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">return</span> inst-&gt;<a class="code" href="classmlir_1_1Operation.html#a919e866989c544204210029d45e45e49">emitError</a>(<span class="stringliteral">&quot;unsupported OpenMP operation: &quot;</span>)</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;               &lt;&lt; inst-&gt;<a class="code" href="classmlir_1_1Operation.html#ab2e11ba83ff765eb7595554f97aaaa75">getName</a>();</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      });</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="namespacemlir.html#a6ea20d97a32efd36c02468e54db4b2e7">  339</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacemlir.html#a6ea20d97a32efd36c02468e54db4b2e7">mlir::registerOpenMPDialectTranslation</a>(<a class="code" href="classmlir_1_1DialectRegistry.html">DialectRegistry</a> &amp;registry) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  registry.<a class="code" href="classmlir_1_1DialectRegistry.html#af7b5c8edb622ee3b1ab5f7103bc7557d">insert</a>&lt;omp::OpenMPDialect&gt;();</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  registry.<a class="code" href="classmlir_1_1DialectRegistry.html#a882bd0aa9c6265cc4fb135e6aefb7066">addDialectInterface</a>&lt;omp::OpenMPDialect,</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                               OpenMPDialectLLVMIRTranslationInterface&gt;();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="namespacemlir.html#aaa35b353841b70d090e1ead360536308">  345</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacemlir.html#a6ea20d97a32efd36c02468e54db4b2e7">mlir::registerOpenMPDialectTranslation</a>(<a class="code" href="classmlir_1_1MLIRContext.html">MLIRContext</a> &amp;context) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <a class="code" href="classmlir_1_1DialectRegistry.html">DialectRegistry</a> registry;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <a class="code" href="namespacemlir.html#a6ea20d97a32efd36c02468e54db4b2e7">registerOpenMPDialectTranslation</a>(registry);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  context.<a class="code" href="classmlir_1_1MLIRContext.html#a0253384ac14aa63ad76b04167c9b3e53">appendDialectRegistry</a>(registry);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div><div class="ttc" id="namespacemlir_html"><div class="ttname"><a href="namespacemlir.html">mlir</a></div><div class="ttdoc">Include the generated interface declarations. </div><div class="ttdef"><b>Definition:</b> <a href="AffineAnalysis_8h_source.html#l00023">AffineAnalysis.h:23</a></div></div>
<div class="ttc" id="classmlir_1_1Region_html"><div class="ttname"><a href="classmlir_1_1Region.html">mlir::Region</a></div><div class="ttdoc">This class contains a list of basic blocks and a link to the parent operation it is attached to...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Region_8h_source.html#l00026">Region.h:26</a></div></div>
<div class="ttc" id="classmlir_1_1Operation_html"><div class="ttname"><a href="classmlir_1_1Operation.html">mlir::Operation</a></div><div class="ttdoc">Operation is a basic unit of execution within MLIR. </div><div class="ttdef"><b>Definition:</b> <a href="Operation_8h_source.html#l00028">Operation.h:28</a></div></div>
<div class="ttc" id="classmlir_1_1Block_html"><div class="ttname"><a href="classmlir_1_1Block.html">mlir::Block</a></div><div class="ttdoc">Block represents an ordered list of Operations. </div><div class="ttdef"><b>Definition:</b> <a href="Block_8h_source.html#l00028">Block.h:28</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html_a5eb37753a783d224c0cd751746c1ad54"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a5eb37753a783d224c0cd751746c1ad54">mlir::LLVM::ModuleTranslation::translateLoc</a></div><div class="ttdeci">const llvm::DILocation * translateLoc(Location loc, llvm::DILocalScope *scope)</div><div class="ttdoc">Translates the given location. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8cpp_source.html#l00725">ModuleTranslation.cpp:725</a></div></div>
<div class="ttc" id="namespacemlir_html_aeec13ab4fb753865cdfd2699aa01c23b"><div class="ttname"><a href="namespacemlir.html#aeec13ab4fb753865cdfd2699aa01c23b">mlir::failed</a></div><div class="ttdeci">bool failed(LogicalResult result)</div><div class="ttdoc">Utility function that returns true if the provided LogicalResult corresponds to a failure value...</div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00072">LogicalResult.h:72</a></div></div>
<div class="ttc" id="OpenMPToLLVMIRTranslation_8cpp_html_ada3742d4afd1f62523af29edc7828d18"><div class="ttname"><a href="OpenMPToLLVMIRTranslation_8cpp.html#ada3742d4afd1f62523af29edc7828d18">convertOmpWsLoop</a></div><div class="ttdeci">static LogicalResult convertOmpWsLoop(Operation &amp;opInst, llvm::IRBuilderBase &amp;builder, LLVM::ModuleTranslation &amp;moduleTranslation)</div><div class="ttdoc">Converts an OpenMP workshare loop into LLVM IR using OpenMPIRBuilder. </div><div class="ttdef"><b>Definition:</b> <a href="OpenMPToLLVMIRTranslation_8cpp_source.html#l00172">OpenMPToLLVMIRTranslation.cpp:172</a></div></div>
<div class="ttc" id="classmlir_1_1Operation_html_a80db2165a86e0837b30f5f3e0dc899df"><div class="ttname"><a href="classmlir_1_1Operation.html#a80db2165a86e0837b30f5f3e0dc899df">mlir::Operation::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands()</div><div class="ttdef"><b>Definition:</b> <a href="Operation_8h_source.html#l00228">Operation.h:228</a></div></div>
<div class="ttc" id="classmlir_1_1MLIRContext_html_a0253384ac14aa63ad76b04167c9b3e53"><div class="ttname"><a href="classmlir_1_1MLIRContext.html#a0253384ac14aa63ad76b04167c9b3e53">mlir::MLIRContext::appendDialectRegistry</a></div><div class="ttdeci">void appendDialectRegistry(const DialectRegistry &amp;registry)</div><div class="ttdoc">Append the contents of the given dialect registry to the registry associated with this context...</div><div class="ttdef"><b>Definition:</b> <a href="MLIRContext_8cpp_source.html#l00443">MLIRContext.cpp:443</a></div></div>
<div class="ttc" id="classllvm_1_1TypeSwitch_html"><div class="ttname"><a href="classllvm_1_1TypeSwitch.html">llvm::TypeSwitch</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVM_8h_source.html#l00063">LLVM.h:63</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html_a04c2e13596c2bc9d0cfada820eea7358"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a04c2e13596c2bc9d0cfada820eea7358">mlir::LLVM::ModuleTranslation::convertBlock</a></div><div class="ttdeci">LogicalResult convertBlock(Block &amp;bb, bool ignoreArguments, llvm::IRBuilderBase &amp;builder)</div><div class="ttdoc">Translates the contents of the given block to LLVM IR using this translator. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8cpp_source.html#l00329">ModuleTranslation.cpp:329</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html_a51bb831df4cf8bf4b4bf13a1be791701"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a51bb831df4cf8bf4b4bf13a1be791701">mlir::LLVM::ModuleTranslation::lookupBlock</a></div><div class="ttdeci">llvm::BasicBlock * lookupBlock(Block *block) const</div><div class="ttdoc">Finds an LLVM IR basic block that corresponds to the given MLIR block. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8h_source.html#l00094">ModuleTranslation.h:94</a></div></div>
<div class="ttc" id="Operation_8h_html"><div class="ttname"><a href="Operation_8h.html">Operation.h</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html_accf46c19a673ef7b85e73343e9eaff38"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html#accf46c19a673ef7b85e73343e9eaff38">mlir::LLVM::ModuleTranslation::mapBlock</a></div><div class="ttdeci">void mapBlock(Block *mlir, llvm::BasicBlock *llvm)</div><div class="ttdoc">Stores the mapping between an MLIR block and LLVM IR basic block. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8h_source.html#l00087">ModuleTranslation.h:87</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html">mlir::LLVM::ModuleTranslation</a></div><div class="ttdoc">Implementation class for module translation. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8h_source.html#l00051">ModuleTranslation.h:51</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html_a9f44e072590ad67cc75d240bfa86b936"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a9f44e072590ad67cc75d240bfa86b936">mlir::LLVM::ModuleTranslation::getOpenMPBuilder</a></div><div class="ttdeci">llvm::OpenMPIRBuilder * getOpenMPBuilder()</div><div class="ttdoc">Returns the OpenMP IR builder associated with the LLVM IR module being constructed. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8h_source.html#l00154">ModuleTranslation.h:154</a></div></div>
<div class="ttc" id="LLVM_8h_html"><div class="ttname"><a href="LLVM_8h.html">LLVM.h</a></div></div>
<div class="ttc" id="namespacemlir_html_a5f55c06c7c4aeace3f6824dd68f8b1ed"><div class="ttname"><a href="namespacemlir.html#a5f55c06c7c4aeace3f6824dd68f8b1ed">mlir::success</a></div><div class="ttdeci">LogicalResult success(bool isSuccess=true)</div><div class="ttdoc">Utility function to generate a LogicalResult. </div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00056">LogicalResult.h:56</a></div></div>
<div class="ttc" id="structmlir_1_1LogicalResult_html"><div class="ttname"><a href="structmlir_1_1LogicalResult.html">mlir::LogicalResult</a></div><div class="ttdoc">This class represents an efficient way to signal success or failure. </div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00026">LogicalResult.h:26</a></div></div>
<div class="ttc" id="namespacemlir_html_a07367c8c4a3d4a47a32bc2b9b7d8a3f4"><div class="ttname"><a href="namespacemlir.html#a07367c8c4a3d4a47a32bc2b9b7d8a3f4">mlir::failure</a></div><div class="ttdeci">LogicalResult failure(bool isFailure=true)</div><div class="ttdoc">Utility function to generate a LogicalResult. </div><div class="ttdef"><b>Definition:</b> <a href="LogicalResult_8h_source.html#l00062">LogicalResult.h:62</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html_af292822b3f890f22fafba471974afa1f"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html#af292822b3f890f22fafba471974afa1f">mlir::LLVM::ModuleTranslation::mapValue</a></div><div class="ttdeci">void mapValue(Value mlir, llvm::Value *llvm)</div><div class="ttdoc">Stores the mapping between an MLIR value and its LLVM IR counterpart. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8h_source.html#l00070">ModuleTranslation.h:70</a></div></div>
<div class="ttc" id="classmlir_1_1LLVMTranslationDialectInterface_html"><div class="ttname"><a href="classmlir_1_1LLVMTranslationDialectInterface.html">mlir::LLVMTranslationDialectInterface</a></div><div class="ttdoc">Base class for dialect interfaces providing translation to LLVM IR. </div><div class="ttdef"><b>Definition:</b> <a href="LLVMTranslationInterface_8h_source.html#l00036">LLVMTranslationInterface.h:36</a></div></div>
<div class="ttc" id="classmlir_1_1Operation_html_a6c0b8ce5ff714a34f0192f3aa60dc7ea"><div class="ttname"><a href="classmlir_1_1Operation.html#a6c0b8ce5ff714a34f0192f3aa60dc7ea">mlir::Operation::getLoc</a></div><div class="ttdeci">Location getLoc()</div><div class="ttdoc">The source location the operation was defined or derived from. </div><div class="ttdef"><b>Definition:</b> <a href="Operation_8h_source.html#l00106">Operation.h:106</a></div></div>
<div class="ttc" id="namespacemlir_html_a6ea20d97a32efd36c02468e54db4b2e7"><div class="ttname"><a href="namespacemlir.html#a6ea20d97a32efd36c02468e54db4b2e7">mlir::registerOpenMPDialectTranslation</a></div><div class="ttdeci">void registerOpenMPDialectTranslation(DialectRegistry &amp;registry)</div><div class="ttdoc">Register the OpenMP dialect and the translation from it to the LLVM IR in the given registry;...</div><div class="ttdef"><b>Definition:</b> <a href="OpenMPToLLVMIRTranslation_8cpp_source.html#l00339">OpenMPToLLVMIRTranslation.cpp:339</a></div></div>
<div class="ttc" id="ModuleTranslation_8h_html"><div class="ttname"><a href="ModuleTranslation_8h.html">ModuleTranslation.h</a></div></div>
<div class="ttc" id="classmlir_1_1LLVM_1_1ModuleTranslation_html_a077b1182e55dd26f2e921fdce534aa38"><div class="ttname"><a href="classmlir_1_1LLVM_1_1ModuleTranslation.html#a077b1182e55dd26f2e921fdce534aa38">mlir::LLVM::ModuleTranslation::lookupValue</a></div><div class="ttdeci">llvm::Value * lookupValue(Value value) const</div><div class="ttdoc">Finds an LLVM IR value corresponding to the given MLIR value. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8h_source.html#l00082">ModuleTranslation.h:82</a></div></div>
<div class="ttc" id="OpenMPToLLVMIRTranslation_8h_html"><div class="ttname"><a href="OpenMPToLLVMIRTranslation_8h.html">OpenMPToLLVMIRTranslation.h</a></div></div>
<div class="ttc" id="namespacemlir_1_1LLVM_1_1detail_html_a2b966f440106b35eb828bab13414c55b"><div class="ttname"><a href="namespacemlir_1_1LLVM_1_1detail.html#a2b966f440106b35eb828bab13414c55b">mlir::LLVM::detail::connectPHINodes</a></div><div class="ttdeci">void connectPHINodes(Region &amp;region, const ModuleTranslation &amp;state)</div><div class="ttdoc">For all blocks in the region that were converted to LLVM IR using the given ModuleTranslation, connect the PHI nodes of the corresponding LLVM IR blocks to the results of preceding blocks. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8cpp_source.html#l00246">ModuleTranslation.cpp:246</a></div></div>
<div class="ttc" id="OpenMPToLLVMIRTranslation_8cpp_html_ab6c3dd7509bd26a6182ff0e8e7138fc9"><div class="ttname"><a href="OpenMPToLLVMIRTranslation_8cpp.html#ab6c3dd7509bd26a6182ff0e8e7138fc9">convertOmpParallel</a></div><div class="ttdeci">static LogicalResult convertOmpParallel(Operation &amp;opInst, llvm::IRBuilderBase &amp;builder, LLVM::ModuleTranslation &amp;moduleTranslation)</div><div class="ttdoc">Converts the OpenMP parallel operation to LLVM IR. </div><div class="ttdef"><b>Definition:</b> <a href="OpenMPToLLVMIRTranslation_8cpp_source.html#l00085">OpenMPToLLVMIRTranslation.cpp:85</a></div></div>
<div class="ttc" id="namespacemlir_1_1LLVM_1_1detail_html_ada0ca08d24a9978d5465be28eba253f0"><div class="ttname"><a href="namespacemlir_1_1LLVM_1_1detail.html#ada0ca08d24a9978d5465be28eba253f0">mlir::LLVM::detail::getTopologicallySortedBlocks</a></div><div class="ttdeci">SetVector&lt; Block * &gt; getTopologicallySortedBlocks(Region &amp;region)</div><div class="ttdoc">Get a topologically sorted list of blocks of the given region. </div><div class="ttdef"><b>Definition:</b> <a href="ModuleTranslation_8cpp_source.html#l00279">ModuleTranslation.cpp:279</a></div></div>
<div class="ttc" id="classmlir_1_1DialectRegistry_html"><div class="ttname"><a href="classmlir_1_1DialectRegistry.html">mlir::DialectRegistry</a></div><div class="ttdoc">The DialectRegistry maps a dialect namespace to a constructor for the matching dialect. </div><div class="ttdef"><b>Definition:</b> <a href="IR_2Dialect_8h_source.html#l00273">Dialect.h:273</a></div></div>
<div class="ttc" id="classmlir_1_1MLIRContext_html"><div class="ttname"><a href="classmlir_1_1MLIRContext.html">mlir::MLIRContext</a></div><div class="ttdoc">MLIRContext is the top-level object for a collection of MLIR operations. </div><div class="ttdef"><b>Definition:</b> <a href="MLIRContext_8h_source.html#l00037">MLIRContext.h:37</a></div></div>
<div class="ttc" id="classmlir_1_1LLVMTranslationDialectInterface_html_acbe047965f9212727c6737919351cab0"><div class="ttname"><a href="classmlir_1_1LLVMTranslationDialectInterface.html#acbe047965f9212727c6737919351cab0">mlir::LLVMTranslationDialectInterface::LLVMTranslationDialectInterface</a></div><div class="ttdeci">LLVMTranslationDialectInterface(Dialect *dialect)</div><div class="ttdef"><b>Definition:</b> <a href="LLVMTranslationInterface_8h_source.html#l00039">LLVMTranslationInterface.h:39</a></div></div>
<div class="ttc" id="OpenMPToLLVMIRTranslation_8cpp_html_a272457451d2c075defa2344ae9905ea8"><div class="ttname"><a href="OpenMPToLLVMIRTranslation_8cpp.html#a272457451d2c075defa2344ae9905ea8">convertOmpMaster</a></div><div class="ttdeci">static LogicalResult convertOmpMaster(Operation &amp;opInst, llvm::IRBuilderBase &amp;builder, LLVM::ModuleTranslation &amp;moduleTranslation)</div><div class="ttdoc">Converts an OpenMP &amp;#39;master&amp;#39; operation into LLVM IR using OpenMPIRBuilder. </div><div class="ttdef"><b>Definition:</b> <a href="OpenMPToLLVMIRTranslation_8cpp_source.html#l00143">OpenMPToLLVMIRTranslation.cpp:143</a></div></div>
<div class="ttc" id="classmlir_1_1DialectRegistry_html_a882bd0aa9c6265cc4fb135e6aefb7066"><div class="ttname"><a href="classmlir_1_1DialectRegistry.html#a882bd0aa9c6265cc4fb135e6aefb7066">mlir::DialectRegistry::addDialectInterface</a></div><div class="ttdeci">void addDialectInterface(TypeID interfaceTypeID, InterfaceAllocatorFunction allocator)</div><div class="ttdoc">Add an interface constructed with the given allocation function to the dialect provided as template p...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Dialect_8h_source.html#l00331">Dialect.h:331</a></div></div>
<div class="ttc" id="OpenMPToLLVMIRTranslation_8cpp_html_adbeb98f08f15ccd391192872751ed65f"><div class="ttname"><a href="OpenMPToLLVMIRTranslation_8cpp.html#adbeb98f08f15ccd391192872751ed65f">convertOmpOpRegions</a></div><div class="ttdeci">static void convertOmpOpRegions(Region &amp;region, StringRef blockName, llvm::BasicBlock &amp;sourceBlock, llvm::BasicBlock &amp;continuationBlock, llvm::IRBuilderBase &amp;builder, LLVM::ModuleTranslation &amp;moduleTranslation, LogicalResult &amp;bodyGenStatus)</div><div class="ttdoc">Converts the given region that appears within an OpenMP dialect operation to LLVM IR...</div><div class="ttdef"><b>Definition:</b> <a href="OpenMPToLLVMIRTranslation_8cpp_source.html#l00030">OpenMPToLLVMIRTranslation.cpp:30</a></div></div>
<div class="ttc" id="OpenMPDialect_8h_html"><div class="ttname"><a href="OpenMPDialect_8h.html">OpenMPDialect.h</a></div></div>
<div class="ttc" id="classmlir_1_1Operation_html_af3f6d9c03a24dea8d37c020ad4f6d1af"><div class="ttname"><a href="classmlir_1_1Operation.html#af3f6d9c03a24dea8d37c020ad4f6d1af">mlir::Operation::emitOpError</a></div><div class="ttdeci">InFlightDiagnostic emitOpError(const Twine &amp;message={})</div><div class="ttdoc">Emit an error with the op name prefixed, like &quot;&amp;#39;dim&amp;#39; op &quot; which is convenient for verifiers...</div><div class="ttdef"><b>Definition:</b> <a href="Operation_8cpp_source.html#l00580">Operation.cpp:580</a></div></div>
<div class="ttc" id="classmlir_1_1Operation_html_ab2e11ba83ff765eb7595554f97aaaa75"><div class="ttname"><a href="classmlir_1_1Operation.html#ab2e11ba83ff765eb7595554f97aaaa75">mlir::Operation::getName</a></div><div class="ttdeci">OperationName getName()</div><div class="ttdoc">The name of an operation is the key identifier for it. </div><div class="ttdef"><b>Definition:</b> <a href="Operation_8h_source.html#l00057">Operation.h:57</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html"><div class="ttname"><a href="classllvm_1_1SetVector.html">llvm::SetVector</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVM_8h_source.html#l00055">LLVM.h:55</a></div></div>
<div class="ttc" id="classmlir_1_1Operation_html_a919e866989c544204210029d45e45e49"><div class="ttname"><a href="classmlir_1_1Operation.html#a919e866989c544204210029d45e45e49">mlir::Operation::emitError</a></div><div class="ttdeci">InFlightDiagnostic emitError(const Twine &amp;message={})</div><div class="ttdoc">Emit an error about fatal conditions with this operation, reporting up to any diagnostic handlers tha...</div><div class="ttdef"><b>Definition:</b> <a href="Operation_8cpp_source.html#l00285">Operation.cpp:285</a></div></div>
<div class="ttc" id="classmlir_1_1DialectRegistry_html_af7b5c8edb622ee3b1ab5f7103bc7557d"><div class="ttname"><a href="classmlir_1_1DialectRegistry.html#af7b5c8edb622ee3b1ab5f7103bc7557d">mlir::DialectRegistry::insert</a></div><div class="ttdeci">void insert()</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Dialect_8h_source.html#l00284">Dialect.h:284</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 30 2021 08:50:52 for MLIR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
