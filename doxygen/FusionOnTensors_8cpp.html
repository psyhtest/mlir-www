<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLIR: lib/Dialect/Linalg/Transforms/FusionOnTensors.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MLIR
   &#160;<span id="projectnumber">13.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_1a25ec519b6c1121408b67cc33ce3f15.html">Dialect</a></li><li class="navelem"><a class="el" href="dir_8edb792440615361a0811a7329611599.html">Linalg</a></li><li class="navelem"><a class="el" href="dir_7e2f808e77498894ca0efbd745da2201.html">Transforms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">FusionOnTensors.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="lib_2Dialect_2Linalg_2Transforms_2PassDetail_8h_source.html">PassDetail.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="AffineOps_8h_source.html">mlir/Dialect/Affine/IR/AffineOps.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="LinalgOps_8h_source.html">mlir/Dialect/Linalg/IR/LinalgOps.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="LinalgTypes_8h_source.html">mlir/Dialect/Linalg/IR/LinalgTypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Dialect_2Linalg_2Passes_8h_source.html">mlir/Dialect/Linalg/Passes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">mlir/Dialect/Linalg/Transforms/Transforms.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Dialect_2Linalg_2Utils_2Utils_8h_source.html">mlir/Dialect/Linalg/Utils/Utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="IR_2AffineExpr_8h_source.html">mlir/IR/AffineExpr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="IR_2AffineMap_8h_source.html">mlir/IR/AffineMap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Matchers_8h_source.html">mlir/IR/Matchers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="PatternMatch_8h_source.html">mlir/IR/PatternMatch.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="LLVM_8h_source.html">mlir/Support/LLVM.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="GreedyPatternRewriteDriver_8h_source.html">mlir/Transforms/GreedyPatternRewriteDriver.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for FusionOnTensors.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="FusionOnTensors_8cpp__incl.png" border="0" usemap="#lib_2Dialect_2Linalg_2Transforms_2FusionOnTensors_8cpp" alt=""/></div>
<map name="lib_2Dialect_2Linalg_2Transforms_2FusionOnTensors_8cpp" id="lib_2Dialect_2Linalg_2Transforms_2FusionOnTensors_8cpp">
<area shape="rect" id="node2" href="lib_2Dialect_2Linalg_2Transforms_2PassDetail_8h.html" title="PassDetail.h" alt="" coords="3691,459,3794,486"/>
<area shape="rect" id="node3" href="AffineOps_8h.html" title="mlir/Dialect/Affine\l/IR/AffineOps.h" alt="" coords="545,541,685,583"/>
<area shape="rect" id="node5" href="IR_2AffineMap_8h.html" title="mlir/IR/AffineMap.h" alt="" coords="2936,727,3083,754"/>
<area shape="rect" id="node6" href="IR_2AffineExpr_8h.html" title="mlir/IR/AffineExpr.h" alt="" coords="3157,817,3304,843"/>
<area shape="rect" id="node7" href="LLVM_8h.html" title="mlir/Support/LLVM.h" alt="" coords="3099,899,3250,925"/>
<area shape="rect" id="node21" href="LinalgOps_8h.html" title="mlir/Dialect/Linalg\l/IR/LinalgOps.h" alt="" coords="1861,363,2003,404"/>
<area shape="rect" id="node22" href="LinalgTypes_8h.html" title="mlir/Dialect/Linalg\l/IR/LinalgTypes.h" alt="" coords="436,452,577,493"/>
<area shape="rect" id="node36" href="Dialect_2Linalg_2Passes_8h.html" title="mlir/Dialect/Linalg\l/Passes.h" alt="" coords="3525,452,3667,493"/>
<area shape="rect" id="node37" href="Dialect_2Linalg_2Transforms_2Transforms_8h.html" title="mlir/Dialect/Linalg\l/Transforms/Transforms.h" alt="" coords="2741,95,2928,136"/>
<area shape="rect" id="node38" href="Dialect_2Linalg_2Utils_2Utils_8h.html" title="mlir/Dialect/Linalg\l/Utils/Utils.h" alt="" coords="1196,184,1337,225"/>
<area shape="rect" id="node45" href="PatternMatch_8h.html" title="mlir/IR/PatternMatch.h" alt="" coords="1005,191,1171,218"/>
<area shape="rect" id="node49" href="Matchers_8h.html" title="mlir/IR/Matchers.h" alt="" coords="2566,727,2706,754"/>
<area shape="rect" id="node50" href="GreedyPatternRewriteDriver_8h.html" title="mlir/Transforms/GreedyPattern\lRewriteDriver.h" alt="" coords="3627,95,3848,136"/>
<area shape="rect" id="node11" href="IR_2Dialect_8h.html" title="mlir/IR/Dialect.h" alt="" coords="2005,973,2131,1000"/>
<area shape="rect" id="node19" href="include_2mlir_2Pass_2Pass_8h.html" title="mlir/Pass/Pass.h" alt="" coords="3526,549,3653,575"/>
<area shape="rect" id="node4" href="AffineMemoryOpInterfaces_8h.html" title="mlir/Dialect/Affine\l/IR/AffineMemoryOpInterfaces.h" alt="" coords="2109,631,2339,672"/>
<area shape="rect" id="node12" href="Ops_8h.html" title="mlir/Dialect/StandardOps\l/IR/Ops.h" alt="" coords="901,631,1086,672"/>
<area shape="rect" id="node16" href="LoopLikeInterface_8h.html" title="mlir/Interfaces/LoopLike\lInterface.h" alt="" coords="91,809,269,851"/>
<area shape="rect" id="node8" href="IR_2BuiltinTypes_8h.html" title="mlir/IR/BuiltinTypes.h" alt="" coords="2253,817,2413,843"/>
<area shape="rect" id="node10" href="OpDefinition_8h.html" title="mlir/IR/OpDefinition.h" alt="" coords="1332,899,1495,925"/>
<area shape="rect" id="node9" href="Types_8h.html" title="mlir/IR/Types.h" alt="" coords="2274,899,2393,925"/>
<area shape="rect" id="node13" href="IR_2Builders_8h.html" title="mlir/IR/Builders.h" alt="" coords="1082,817,1217,843"/>
<area shape="rect" id="node14" href="SideEffectInterfaces_8h.html" title="mlir/Interfaces/SideEffect\lInterfaces.h" alt="" coords="748,720,935,761"/>
<area shape="rect" id="node15" href="ViewLikeInterface_8h.html" title="mlir/Interfaces/ViewLike\lInterface.h" alt="" coords="1809,720,1989,761"/>
<area shape="rect" id="node26" href="StructuredOpsUtils_8h.html" title="mlir/Dialect/Utils\l/StructuredOpsUtils.h" alt="" coords="2987,631,3147,672"/>
<area shape="rect" id="node27" href="BlockAndValueMapping_8h.html" title="mlir/IR/BlockAndValueMapping.h" alt="" coords="1517,638,1750,665"/>
<area shape="rect" id="node28" href="BuiltinDialect_8h.html" title="mlir/IR/BuiltinDialect.h" alt="" coords="2782,899,2951,925"/>
<area shape="rect" id="node29" href="TypeUtilities_8h.html" title="mlir/IR/TypeUtilities.h" alt="" coords="1539,459,1701,486"/>
<area shape="rect" id="node31" href="CopyOpInterface_8h.html" title="mlir/Interfaces/CopyOpInterface.h" alt="" coords="1292,817,1535,843"/>
<area shape="rect" id="node32" href="InferTypeOpInterface_8h.html" title="mlir/Interfaces/InferType\lOpInterface.h" alt="" coords="1369,720,1551,761"/>
<area shape="rect" id="node33" href="LinalgInterfaces_8h.html" title="mlir/Dialect/Linalg\l/IR/LinalgInterfaces.h" alt="" coords="2097,541,2255,583"/>
<area shape="rect" id="node23" href="Dialect_2Tensor_2IR_2Tensor_8h.html" title="mlir/Dialect/Tensor\l/IR/Tensor.h" alt="" coords="115,631,259,672"/>
<area shape="rect" id="node42" href="Dialect_2SCF_2Utils_8h.html" title="mlir/Dialect/SCF/Utils.h" alt="" coords="3126,459,3298,486"/>
<area shape="rect" id="node43" href="VectorOps_8h.html" title="mlir/Dialect/Vector\l/VectorOps.h" alt="" coords="2465,631,2607,672"/>
<area shape="rect" id="node44" href="Identifier_8h.html" title="mlir/IR/Identifier.h" alt="" coords="3261,370,3400,397"/>
<area shape="rect" id="node46" href="Bufferize_8h.html" title="mlir/Transforms/Bufferize.h" alt="" coords="1013,549,1211,575"/>
<area shape="rect" id="node39" href="Affine_2EDSC_2Intrinsics_8h.html" title="mlir/Dialect/Affine\l/EDSC/Intrinsics.h" alt="" coords="1197,273,1337,315"/>
<area shape="rect" id="node40" href="DependenceAnalysis_8h.html" title="mlir/Dialect/Linalg\l/Analysis/DependenceAnalysis.h" alt="" coords="761,273,994,315"/>
<area shape="rect" id="node41" href="Dialect_2Linalg_2EDSC_2Builders_8h.html" title="mlir/Dialect/Linalg\l/EDSC/Builders.h" alt="" coords="1969,273,2111,315"/>
</map>
</div>
</div>
<p><a href="FusionOnTensors_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4260b185f273d6bd4f0cb17c58f2d3f1"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a4260b185f273d6bd4f0cb17c58f2d3f1">areElementwiseOpsFusable</a> (LinalgOp producer, LinalgOp consumer, <a class="el" href="classunsigned.html">unsigned</a> consumerIdx)</td></tr>
<tr class="memdesc:a4260b185f273d6bd4f0cb17c58f2d3f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of fusion of generic ops and indexed_generic ops.  <a href="#a4260b185f273d6bd4f0cb17c58f2d3f1">More...</a><br /></td></tr>
<tr class="separator:a4260b185f273d6bd4f0cb17c58f2d3f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dc3d6e5fc7922aecc218cfb907af153"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a3dc3d6e5fc7922aecc218cfb907af153">getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp</a> (<a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> &amp;producerOpOperand, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> producerResultIndexMap, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> fusedConsumerArgIndexMap)</td></tr>
<tr class="memdesc:a3dc3d6e5fc7922aecc218cfb907af153"><td class="mdescLeft">&#160;</td><td class="mdescRight">Append to <code>fusedOpIndexingMapAttrs</code> the indexing maps for the operands of the <code>producer</code> to use in the fused operation given the indexing map of the result of the producer in the consumer.  <a href="#a3dc3d6e5fc7922aecc218cfb907af153">More...</a><br /></td></tr>
<tr class="separator:a3dc3d6e5fc7922aecc218cfb907af153"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95eca28a76821355e1673b7456537b81"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classvoid.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a95eca28a76821355e1673b7456537b81">generateFusedElementwiseOpRegion</a> (<a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, <a class="el" href="classmlir_1_1Operation.html">Operation</a> *fusedOp, LinalgOp producer, LinalgOp consumer, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> consumerToProducerLoopsMap, <a class="el" href="classunsigned.html">unsigned</a> consumerIdx, <a class="el" href="classunsigned.html">unsigned</a> nloops)</td></tr>
<tr class="memdesc:a95eca28a76821355e1673b7456537b81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate the region of the fused tensor operation.  <a href="#a95eca28a76821355e1673b7456537b81">More...</a><br /></td></tr>
<tr class="separator:a95eca28a76821355e1673b7456537b81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ac71f3f4c92a6286795ab1ae5eb5f0b"><td class="memItemLeft" align="right" valign="top">static Optional&lt; SmallVector&lt; <a class="el" href="classmlir_1_1Value.html">Value</a>, 1 &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a4ac71f3f4c92a6286795ab1ae5eb5f0b">fuseElementwiseOpsImpl</a> (LinalgOp producer, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> &amp;consumerOpOperand, const <a class="el" href="namespacemlir_1_1linalg.html#a6be0ca40b26b11f57a267d8c03b6c162">ControlElementwiseOpsFusionFn</a> &amp;controlFn, <a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter)</td></tr>
<tr class="separator:a4ac71f3f4c92a6286795ab1ae5eb5f0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39deb48b483c295bb262e04a606b0c91"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a39deb48b483c295bb262e04a606b0c91">linearizeCollapsedDims</a> (<a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> sourceMap, <a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; int64_t &gt; sourceShape, <a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> &gt; reassociationMaps)</td></tr>
<tr class="memdesc:a39deb48b483c295bb262e04a606b0c91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Linearize the expressions in <code>sourceMap</code> based on the <code>reassociationMaps</code> provided, given the shape of the source tensor that corresponds to the <code>sourceMap</code>.  <a href="#a39deb48b483c295bb262e04a606b0c91">More...</a><br /></td></tr>
<tr class="separator:a39deb48b483c295bb262e04a606b0c91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00d2f3438facde5a3175b2af173485f5"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a00d2f3438facde5a3175b2af173485f5">isTensorReshapeOpFoldableByLinearization</a> (TensorReshapeOp reshapeOp, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> useIndexMap, bool asProducer)</td></tr>
<tr class="memdesc:a00d2f3438facde5a3175b2af173485f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the <code>reshapeOp</code> can be fused with it consumer (if <code>asProducer</code> is true) or its producer (if <code>asProducer</code> is false) given the indexing map at its use.  <a href="#a00d2f3438facde5a3175b2af173485f5">More...</a><br /></td></tr>
<tr class="separator:a00d2f3438facde5a3175b2af173485f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fe022bd9cf7e2f46a500b144023b688"><td class="memTemplParams" colspan="2">template&lt;typename... Args&gt; </td></tr>
<tr class="memitem:a7fe022bd9cf7e2f46a500b144023b688"><td class="memTemplItemLeft" align="right" valign="top">static LinalgOp&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a7fe022bd9cf7e2f46a500b144023b688">createLinalgOpOfSameType</a> (LinalgOp op, <a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, Args... args)</td></tr>
<tr class="memdesc:a7fe022bd9cf7e2f46a500b144023b688"><td class="mdescLeft">&#160;</td><td class="mdescRight">Based on the type of <code>op</code> create a linalg op of the same type, i.e.  <a href="#a7fe022bd9cf7e2f46a500b144023b688">More...</a><br /></td></tr>
<tr class="separator:a7fe022bd9cf7e2f46a500b144023b688"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a99149fc8a29f0530e6acca3f05d3af"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a0a99149fc8a29f0530e6acca3f05d3af">isUnitDimExpansionOnly</a> (<a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; int64_t &gt; expandedShape, <a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> &gt; reassociation)</td></tr>
<tr class="memdesc:a0a99149fc8a29f0530e6acca3f05d3af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the reshape operation is only expansion into/collapsing of unit-dimension.  <a href="#a0a99149fc8a29f0530e6acca3f05d3af">More...</a><br /></td></tr>
<tr class="separator:a0a99149fc8a29f0530e6acca3f05d3af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4d5887314ee1fee0c0eb0772f2d064b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#aa4d5887314ee1fee0c0eb0772f2d064b">isFusableWithReshapeByDimExpansion</a> (LinalgOp linalgOp, <a class="el" href="classunsigned.html">unsigned</a> fusedTensorIndex)</td></tr>
<tr class="memdesc:aa4d5887314ee1fee0c0eb0772f2d064b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conditions for folding a generic/indexed-generic operation with a reshape op by expanding the iteration space dimensionality for tensor operations.  <a href="#aa4d5887314ee1fee0c0eb0772f2d064b">More...</a><br /></td></tr>
<tr class="separator:aa4d5887314ee1fee0c0eb0772f2d064b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a861d3ebb6418a72a09f11866eec0a1bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmlir_1_1LogicalResult.html">LogicalResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a861d3ebb6418a72a09f11866eec0a1bd">isIndexedOpExpandable</a> (LinalgOp linalgOp, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:a861d3ebb6418a72a09f11866eec0a1bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Epanding the body of a linalg operation requires adaptations of the accessed loop indices.  <a href="#a861d3ebb6418a72a09f11866eec0a1bd">More...</a><br /></td></tr>
<tr class="separator:a861d3ebb6418a72a09f11866eec0a1bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff1bcc53176a04b539b16e59cbac323e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#aff1bcc53176a04b539b16e59cbac323e">getIndexingMapInExpandedOp</a> (<a class="el" href="classmlir_1_1OpBuilder.html">OpBuilder</a> &amp;builder, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> indexingMap, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:aff1bcc53176a04b539b16e59cbac323e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the indexing map to use in the expanded op for a given the <code>indexingMap</code> of the original operation.  <a href="#aff1bcc53176a04b539b16e59cbac323e">More...</a><br /></td></tr>
<tr class="separator:aff1bcc53176a04b539b16e59cbac323e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9ac3c8d820ffb7c2bde775b389c040c"><td class="memItemLeft" align="right" valign="top">static RankedTensorType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#af9ac3c8d820ffb7c2bde775b389c040c">getExpandedType</a> (RankedTensorType originalType, <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> indexingMap, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:af9ac3c8d820ffb7c2bde775b389c040c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the type of the operand/result to use in the expanded op given the type in the original op.  <a href="#af9ac3c8d820ffb7c2bde775b389c040c">More...</a><br /></td></tr>
<tr class="separator:af9ac3c8d820ffb7c2bde775b389c040c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe92bf4ebc5f9c773f8b2ae93d58a809"><td class="memItemLeft" align="right" valign="top">static SmallVector&lt; <a class="el" href="namespacemlir_1_1linalg.html#ab69975b2f4b34a10326a9b5535288ce6">ReassociationIndices</a>, 4 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#abe92bf4ebc5f9c773f8b2ae93d58a809">getReassociationForExpansion</a> (<a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> indexingMap, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:abe92bf4ebc5f9c773f8b2ae93d58a809"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the reassociation maps to use in the <code>linalg.tensor_reshape</code> operation to convert the operands of the origial operation to operands of the expanded operation.  <a href="#abe92bf4ebc5f9c773f8b2ae93d58a809">More...</a><br /></td></tr>
<tr class="separator:abe92bf4ebc5f9c773f8b2ae93d58a809"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdda399f99af5c800351ca2cd3843268"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classvoid.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#acdda399f99af5c800351ca2cd3843268">buildExpandedIndexedGenericOpRegion</a> (<a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, <a class="el" href="classmlir_1_1Location.html">Location</a> loc, <a class="el" href="classmlir_1_1Region.html">Region</a> &amp;originalOpRegion, <a class="el" href="classmlir_1_1Region.html">Region</a> &amp;fusedOpRegion, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:acdda399f99af5c800351ca2cd3843268"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build the body of the expanded IndexedGenericOp.  <a href="#acdda399f99af5c800351ca2cd3843268">More...</a><br /></td></tr>
<tr class="separator:acdda399f99af5c800351ca2cd3843268"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc0332a7f24654b05ef9d3401d21bb7e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classvoid.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#abc0332a7f24654b05ef9d3401d21bb7e">updateExpandedIndexOpRegion</a> (<a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, <a class="el" href="classmlir_1_1Location.html">Location</a> loc, <a class="el" href="classmlir_1_1Region.html">Region</a> &amp;fusedRegion, const ExpansionInfo &amp;expansionInfo)</td></tr>
<tr class="memdesc:abc0332a7f24654b05ef9d3401d21bb7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the body of an expanded linalg operation having index semantics.  <a href="#abc0332a7f24654b05ef9d3401d21bb7e">More...</a><br /></td></tr>
<tr class="separator:abc0332a7f24654b05ef9d3401d21bb7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab606507e0b00b1caf38d5f92d8d6684c"><td class="memItemLeft" align="right" valign="top">static Optional&lt; SmallVector&lt; <a class="el" href="classmlir_1_1Value.html">Value</a>, 1 &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#ab606507e0b00b1caf38d5f92d8d6684c">fuseWithReshapeByExpansion</a> (LinalgOp linalgOp, TensorReshapeOp reshapeOp, <a class="el" href="classunsigned.html">unsigned</a> fusedTensorIndex, <a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter)</td></tr>
<tr class="memdesc:ab606507e0b00b1caf38d5f92d8d6684c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements the fusion of a tensor_reshape op and a generic/indexed_generic op as explained in <code>isFusableWithReshapeByExpansion</code>.  <a href="#ab606507e0b00b1caf38d5f92d8d6684c">More...</a><br /></td></tr>
<tr class="separator:ab606507e0b00b1caf38d5f92d8d6684c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dc31fbd6b59d437d3353ff2ba607fff"><td class="memItemLeft" align="right" valign="top">static Optional&lt; SmallVector&lt; <a class="el" href="classmlir_1_1Value.html">Value</a>, 1 &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="FusionOnTensors_8cpp.html#a0dc31fbd6b59d437d3353ff2ba607fff">fuseElementwiseOps</a> (<a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;rewriter, <a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> &amp;consumerOpOperand, const <a class="el" href="namespacemlir_1_1linalg.html#a6be0ca40b26b11f57a267d8c03b6c162">ControlElementwiseOpsFusionFn</a> &amp;controlFn)</td></tr>
<tr class="separator:a0dc31fbd6b59d437d3353ff2ba607fff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a4260b185f273d6bd4f0cb17c58f2d3f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4260b185f273d6bd4f0cb17c58f2d3f1">&#9670;&nbsp;</a></span>areElementwiseOpsFusable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool areElementwiseOpsFusable </td>
          <td>(</td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>producer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>consumer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classunsigned.html">unsigned</a>&#160;</td>
          <td class="paramname"><em>consumerIdx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implementation of fusion of generic ops and indexed_generic ops. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00030">30</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00303">mlir::AffineMap::getNumResults()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00483">mlir::AffineMap::isPermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00248">fuseElementwiseOpsImpl()</a>.</p>

</div>
</div>
<a id="acdda399f99af5c800351ca2cd3843268"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdda399f99af5c800351ca2cd3843268">&#9670;&nbsp;</a></span>buildExpandedIndexedGenericOpRegion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classvoid.html">void</a> buildExpandedIndexedGenericOpRegion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Location.html">Location</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Region.html">Region</a> &amp;&#160;</td>
          <td class="paramname"><em>originalOpRegion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Region.html">Region</a> &amp;&#160;</td>
          <td class="paramname"><em>fusedOpRegion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build the body of the expanded IndexedGenericOp. </p>
<p>The arguments for the induction variables of the original operation need to be recovered by linearizing the arguments of the corresponding dimensions of the expanded op. For now it is assumed that the shapes of the expanded op needed for linearization are static. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00708">708</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="PatternMatch_8cpp_source.html#l00327">mlir::RewriterBase::cloneRegionBefore()</a>, <a class="el" href="IR_2Region_8h_source.html#l00060">mlir::Region::empty()</a>, <a class="el" href="IR_2Region_8h_source.html#l00056">mlir::Region::end()</a>, <a class="el" href="IR_2Region_8h_source.html#l00115">mlir::Region::getArgument()</a>, <a class="el" href="IR_2Builders_8cpp_source.html#l00052">mlir::Builder::getIndexType()</a>, <a class="el" href="IR_2Region_8h_source.html#l00114">mlir::Region::getNumArguments()</a>, <a class="el" href="Value_8h_source.html#l00113">mlir::Value::getType()</a>, <a class="el" href="IR_2BuiltinTypes_8h_source.html#l00138">mlir::ShapedType::isDynamic()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00253">mlir::RewriterBase::mergeBlocks()</a>, <a class="el" href="IR_2Region_8h_source.html#l00061">mlir::Region::push_back()</a>, and <a class="el" href="IR_2Builders_8h_source.html#l00348">mlir::OpBuilder::setInsertionPointToStart()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a7fe022bd9cf7e2f46a500b144023b688"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fe022bd9cf7e2f46a500b144023b688">&#9670;&nbsp;</a></span>createLinalgOpOfSameType()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename... Args&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static LinalgOp createLinalgOpOfSameType </td>
          <td>(</td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Based on the type of <code>op</code> create a linalg op of the same type, i.e. </p>
<p>if <code>op</code> is a linalg.generic operation, the create a <code>linalg.generic</code> operation with the given <code>args</code>. Expects <code>op</code> to be <code>linalg.generic</code> or <code>linalg.indexed_generic</code>. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00436">436</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2Builders_8h_source.html#l00393">mlir::OpBuilder::create()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a0dc31fbd6b59d437d3353ff2ba607fff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dc31fbd6b59d437d3353ff2ba607fff">&#9670;&nbsp;</a></span>fuseElementwiseOps()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Optional&lt;SmallVector&lt;<a class="el" href="classmlir_1_1Value.html">Value</a>, 1&gt; &gt; fuseElementwiseOps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> &amp;&#160;</td>
          <td class="paramname"><em>consumerOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacemlir_1_1linalg.html#a6be0ca40b26b11f57a267d8c03b6c162">ControlElementwiseOpsFusionFn</a> &amp;&#160;</td>
          <td class="paramname"><em>controlFn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l01379">1379</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="GreedyPatternRewriteDriver_8cpp_source.html#l00219">mlir::applyPatternsAndFoldGreedily()</a>, <a class="el" href="LogicalResult_8h_source.html#l00062">mlir::failure()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00248">fuseElementwiseOpsImpl()</a>, <a class="el" href="Value_8cpp_source.html#l00209">mlir::OpOperand::get()</a>, <a class="el" href="Operation_8cpp_source.html#l00220">mlir::Operation::getContext()</a>, <a class="el" href="Value_8cpp_source.html#l00020">mlir::Value::getDefiningOp()</a>, <a class="el" href="Operation_8h_source.html#l00281">mlir::Operation::getNumResults()</a>, <a class="el" href="UseDefLists_8h_source.html#l00136">mlir::IROperand&lt; DerivedT, IRValueTy &gt;::getOwner()</a>, <a class="el" href="Operation_8h_source.html#l00429">mlir::Operation::getRegions()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l01478">mlir::linalg::populateElementwiseOpsFusionPatterns()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l01454">mlir::linalg::populateFoldReshapeOpsByLinearizationPatterns()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00221">mlir::RewriterBase::replaceOp()</a>, and <a class="el" href="LogicalResult_8h_source.html#l00056">mlir::success()</a>.</p>

</div>
</div>
<a id="a4ac71f3f4c92a6286795ab1ae5eb5f0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ac71f3f4c92a6286795ab1ae5eb5f0b">&#9670;&nbsp;</a></span>fuseElementwiseOpsImpl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Optional&lt;SmallVector&lt;<a class="el" href="classmlir_1_1Value.html">Value</a>, 1&gt; &gt; fuseElementwiseOpsImpl </td>
          <td>(</td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>producer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> &amp;&#160;</td>
          <td class="paramname"><em>consumerOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacemlir_1_1linalg.html#a6be0ca40b26b11f57a267d8c03b6c162">ControlElementwiseOpsFusionFn</a> &amp;&#160;</td>
          <td class="paramname"><em>controlFn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00248">248</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="FusionOnTensors_8cpp_source.html#l00030">areElementwiseOpsFusable()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00428">mlir::AffineMap::compose()</a>, <a class="el" href="IR_2Builders_8h_source.html#l00393">mlir::OpBuilder::create()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00098">generateFusedElementwiseOpRegion()</a>, <a class="el" href="IR_2Builders_8cpp_source.html#l00275">mlir::Builder::getAffineMapArrayAttr()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00065">getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp()</a>, <a class="el" href="Value_8cpp_source.html#l00219">mlir::OpOperand::getOperandNumber()</a>, <a class="el" href="UseDefLists_8h_source.html#l00136">mlir::IROperand&lt; DerivedT, IRValueTy &gt;::getOwner()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00643">mlir::inversePermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l01379">fuseElementwiseOps()</a>.</p>

</div>
</div>
<a id="ab606507e0b00b1caf38d5f92d8d6684c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab606507e0b00b1caf38d5f92d8d6684c">&#9670;&nbsp;</a></span>fuseWithReshapeByExpansion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Optional&lt;SmallVector&lt;<a class="el" href="classmlir_1_1Value.html">Value</a>, 1&gt; &gt; fuseWithReshapeByExpansion </td>
          <td>(</td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>linalgOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TensorReshapeOp&#160;</td>
          <td class="paramname"><em>reshapeOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classunsigned.html">unsigned</a>&#160;</td>
          <td class="paramname"><em>fusedTensorIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements the fusion of a tensor_reshape op and a generic/indexed_generic op as explained in <code>isFusableWithReshapeByExpansion</code>. </p>
<p>Assumes that those conditions have been satisfied. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">802</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2Region_8h_source.html#l00055">mlir::Region::begin()</a>, <a class="el" href="Block_8h_source.html#l00131">mlir::Block::begin()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00708">buildExpandedIndexedGenericOpRegion()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00327">mlir::RewriterBase::cloneRegionBefore()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00667">mlir::concatAffineMaps()</a>, <a class="el" href="IR_2Builders_8h_source.html#l00393">mlir::OpBuilder::create()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00436">createLinalgOpOfSameType()</a>, <a class="el" href="Matchers_8h_source.html#l00196">mlir::detail::enumerate()</a>, <a class="el" href="LogicalResult_8h_source.html#l00072">mlir::failed()</a>, <a class="el" href="LogicalResult_8h_source.html#l00062">mlir::failure()</a>, <a class="el" href="PatternMatch_8h_source.html#l00712">mlir::RewriterBase::finalizeRootUpdate()</a>, <a class="el" href="MLIRContext_8cpp_source.html#l00957">mlir::AffineMap::get()</a>, <a class="el" href="IR_2AffineExpr_8cpp_source.html#l00482">mlir::getAffineDimExpr()</a>, <a class="el" href="IR_2Builders_8cpp_source.html#l00275">mlir::Builder::getAffineMapArrayAttr()</a>, <a class="el" href="Block_8h_source.html#l00117">mlir::Block::getArgument()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00321">mlir::AffineMap::getDimPosition()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00670">getExpandedType()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00652">getIndexingMapInExpandedOp()</a>, <a class="el" href="Operation_8h_source.html#l00106">mlir::Operation::getLoc()</a>, <a class="el" href="Block_8h_source.html#l00116">mlir::Block::getNumArguments()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00303">mlir::AffineMap::getNumResults()</a>, <a class="el" href="StructuredOpsUtils_8h_source.html#l00074">mlir::getParallelIteratorTypeName()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00688">getReassociationForExpansion()</a>, <a class="el" href="Operation_8h_source.html#l00284">mlir::Operation::getResult()</a>, <a class="el" href="IR_2BuiltinAttributes_8h_source.html#l00403">mlir::DenseElementsAttr::getSplatValue()</a>, <a class="el" href="Value_8h_source.html#l00113">mlir::Value::getType()</a>, <a class="el" href="OperationSupport_8h_source.html#l00827">mlir::ValueRange::getTypes()</a>, <a class="el" href="IR_2Builders_8cpp_source.html#l00030">mlir::Builder::getUnknownLoc()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00315">mlir::RewriterBase::inlineRegionBefore()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00643">mlir::inversePermutation()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00525">isFusableWithReshapeByDimExpansion()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00632">isIndexedOpExpandable()</a>, <a class="el" href="IR_2BuiltinAttributes_8cpp_source.html#l00866">mlir::DenseElementsAttr::isSplat()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00412">isTensorReshapeOpFoldableByLinearization()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00449">isUnitDimExpansionOnly()</a>, <a class="el" href="FusionOnTensors_8cpp_source.html#l00375">linearizeCollapsedDims()</a>, <a class="el" href="BlockAndValueMapping_8h_source.html#l00030">mlir::BlockAndValueMapping::map()</a>, <a class="el" href="Matchers_8h_source.html#l00256">mlir::matchPattern()</a>, <a class="el" href="PatternMatch_8h_source.html#l00735">mlir::RewriterBase::notifyMatchFailure()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00221">mlir::RewriterBase::replaceOp()</a>, <a class="el" href="PatternMatch_8h_source.html#l00707">mlir::RewriterBase::startRootUpdate()</a>, <a class="el" href="LogicalResult_8h_source.html#l00056">mlir::success()</a>, and <a class="el" href="FusionOnTensors_8cpp_source.html#l00760">updateExpandedIndexOpRegion()</a>.</p>

</div>
</div>
<a id="a95eca28a76821355e1673b7456537b81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95eca28a76821355e1673b7456537b81">&#9670;&nbsp;</a></span>generateFusedElementwiseOpRegion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classvoid.html">void</a> generateFusedElementwiseOpRegion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Operation.html">Operation</a> *&#160;</td>
          <td class="paramname"><em>fusedOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>producer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>consumer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>consumerToProducerLoopsMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classunsigned.html">unsigned</a>&#160;</td>
          <td class="paramname"><em>consumerIdx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classunsigned.html">unsigned</a>&#160;</td>
          <td class="paramname"><em>nloops</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate the region of the fused tensor operation. </p>
<p>The region of the fused op must be empty. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00098">98</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="Block_8cpp_source.html#l00141">mlir::Block::addArgument()</a>, <a class="el" href="IR_2Builders_8cpp_source.html#l00468">mlir::OpBuilder::clone()</a>, <a class="el" href="IR_2Builders_8h_source.html#l00393">mlir::OpBuilder::create()</a>, <a class="el" href="Value_8h_source.html#l00097">mlir::Value::dyn_cast()</a>, <a class="el" href="Block_8h_source.html#l00141">mlir::Block::front()</a>, <a class="el" href="Block_8h_source.html#l00117">mlir::Block::getArgument()</a>, <a class="el" href="Block_8h_source.html#l00075">mlir::Block::getArguments()</a>, <a class="el" href="Value_8cpp_source.html#l00020">mlir::Value::getDefiningOp()</a>, <a class="el" href="IR_2Builders_8cpp_source.html#l00052">mlir::Builder::getIndexType()</a>, <a class="el" href="Block_8h_source.html#l00116">mlir::Block::getNumArguments()</a>, <a class="el" href="Operation_8h_source.html#l00228">mlir::Operation::getNumOperands()</a>, <a class="el" href="Block_8h_source.html#l00125">mlir::Block::getOperations()</a>, <a class="el" href="Block_8h_source.html#l00180">mlir::Block::getOps()</a>, <a class="el" href="Operation_8h_source.html#l00435">mlir::Operation::getRegion()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00489">mlir::AffineMap::getSubMap()</a>, <a class="el" href="Block_8cpp_source.html#l00225">mlir::Block::getTerminator()</a>, <a class="el" href="Value_8h_source.html#l00113">mlir::Value::getType()</a>, <a class="el" href="BlockAndValueMapping_8h_source.html#l00063">mlir::BlockAndValueMapping::lookupOrDefault()</a>, <a class="el" href="BlockAndValueMapping_8h_source.html#l00030">mlir::BlockAndValueMapping::map()</a>, <a class="el" href="PolynomialApproximation_8cpp_source.html#l00111">max()</a>, <a class="el" href="IR_2Region_8h_source.html#l00061">mlir::Region::push_back()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00221">mlir::RewriterBase::replaceOp()</a>, <a class="el" href="IR_2Builders_8h_source.html#l00348">mlir::OpBuilder::setInsertionPointToStart()</a>, and <a class="el" href="Block_8h_source.html#l00194">mlir::Block::without_terminator()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00248">fuseElementwiseOpsImpl()</a>.</p>

</div>
</div>
<a id="af9ac3c8d820ffb7c2bde775b389c040c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9ac3c8d820ffb7c2bde775b389c040c">&#9670;&nbsp;</a></span>getExpandedType()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static RankedTensorType getExpandedType </td>
          <td>(</td>
          <td class="paramtype">RankedTensorType&#160;</td>
          <td class="paramname"><em>originalType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>indexingMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the type of the operand/result to use in the expanded op given the type in the original op. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00670">670</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00312">mlir::AffineMap::getResults()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="aff1bcc53176a04b539b16e59cbac323e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff1bcc53176a04b539b16e59cbac323e">&#9670;&nbsp;</a></span>getIndexingMapInExpandedOp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> getIndexingMapInExpandedOp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpBuilder.html">OpBuilder</a> &amp;&#160;</td>
          <td class="paramname"><em>builder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>indexingMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the indexing map to use in the expanded op for a given the <code>indexingMap</code> of the original operation. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00652">652</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="MLIRContext_8cpp_source.html#l00957">mlir::AffineMap::get()</a>, <a class="el" href="IR_2Builders_8cpp_source.html#l00302">mlir::Builder::getAffineDimExpr()</a>, <a class="el" href="IR_2Builders_8h_source.html#l00053">mlir::Builder::getContext()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00299">mlir::AffineMap::getNumSymbols()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00312">mlir::AffineMap::getResults()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a3dc3d6e5fc7922aecc218cfb907af153"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dc3d6e5fc7922aecc218cfb907af153">&#9670;&nbsp;</a></span>getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> getIndexingMapOfProducerOperandsInCoordinatesOfFusedOp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1OpOperand.html">OpOperand</a> &amp;&#160;</td>
          <td class="paramname"><em>producerOpOperand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>producerResultIndexMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>fusedConsumerArgIndexMap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Append to <code>fusedOpIndexingMapAttrs</code> the indexing maps for the operands of the <code>producer</code> to use in the fused operation given the indexing map of the result of the producer in the consumer. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00065">65</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00428">mlir::AffineMap::compose()</a>, <a class="el" href="Value_8cpp_source.html#l00219">mlir::OpOperand::getOperandNumber()</a>, <a class="el" href="UseDefLists_8h_source.html#l00136">mlir::IROperand&lt; DerivedT, IRValueTy &gt;::getOwner()</a>, and <a class="el" href="IR_2AffineMap_8cpp_source.html#l00643">mlir::inversePermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00248">fuseElementwiseOpsImpl()</a>.</p>

</div>
</div>
<a id="abe92bf4ebc5f9c773f8b2ae93d58a809"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe92bf4ebc5f9c773f8b2ae93d58a809">&#9670;&nbsp;</a></span>getReassociationForExpansion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static SmallVector&lt;<a class="el" href="namespacemlir_1_1linalg.html#ab69975b2f4b34a10326a9b5535288ce6">ReassociationIndices</a>, 4&gt; getReassociationForExpansion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>indexingMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the reassociation maps to use in the <code>linalg.tensor_reshape</code> operation to convert the operands of the origial operation to operands of the expanded operation. </p>
<p>The same method is used to compute the <code>linalg.tensor_reshape</code> used to collapse the result of the expanded op to get the value that can replace all uses of the results of the original op. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00688">688</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00312">mlir::AffineMap::getResults()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="aa4d5887314ee1fee0c0eb0772f2d064b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4d5887314ee1fee0c0eb0772f2d064b">&#9670;&nbsp;</a></span>isFusableWithReshapeByDimExpansion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool isFusableWithReshapeByDimExpansion </td>
          <td>(</td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>linalgOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classunsigned.html">unsigned</a>&#160;</td>
          <td class="paramname"><em>fusedTensorIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Conditions for folding a generic/indexed-generic operation with a reshape op by expanding the iteration space dimensionality for tensor operations. </p>
<p>These are preconditions assumed by <code>foldReshapeByDimExpansion</code> which implements the following fusion pattern.</p>
<p>Consider</p>
<p>c = linalg.generic ins(a, b : memref&lt;?x?x?xf32&gt;, memref&lt;?x?xf32&gt;) indexing_maps = [affine_map&lt;(d0, d1, d2) -&gt; (d1, d0, d2)&gt;, affine_map&lt;(d0, d1, d2) -&gt; (d1, d2)&gt;, affine_map&lt;(d0, d1, d2) -&gt; (d0, d2, d1)&gt;] d = linalg.tensor_reshape c [affine_map&lt;(d0, d1, d2, d3, d4, d5) -&gt; (d0, d1)&gt;, affine_map&lt;(d0, d1, d2, d3, d4, d5) -&gt; (d2)&gt;, affine_map&lt;(d0, d1, d2, d3, d4, d5) -&gt; (d3, d4, d5)&gt;] : tensor&lt;?x?x?xf32&gt; into tensor&lt;?x?x?x?x?x?xf32&gt;</p>
<p>The reshape can be folded into the <code>linalgOp</code> if the generic/indexed-generic op loop dimensionality is increased to match the result (operand) of the tensor_reshape when the reshape is expanding (folding). The indexing_map of the fused tensor in the <code>linalgOp</code> and the reassociation map helps compute the indexing maps of the modified op. For the above example, based on the reassociation map it can be concluded that</p>
<ul>
<li>The loop used to access the first dimension of the fused tensor is split into two.</li>
<li>The loop used to access the second dimension of the fused tensor is kept as is.</li>
<li>The loop used to access the third dimension of the fused tensor is split into three.</li>
</ul>
<p>i.e. (e0, e1, e2, e3, e4) is the domain of the indexing map of the modified op, then</p>
<p>d0 -&gt; e0, e1 d1 -&gt; e2, e3, e4 d2 -&gt; e5</p>
<p>substituting this, the generic op can be rewritten as</p>
<p>d = linalg.generic ins(%0, %1 : ) indexing_maps = [affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e2, e3, e4, e0, e1, e5)&gt;, affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e2, e3, e4, e5)&gt;, affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e0, e1, e5, e2, e3, e4)&gt;]</p>
<p>Since operands to the linalg generic are now 5D, reshapes can be introduced to make it consistent</p>
<p>%0 = linalg.tensor_reshape a [affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e0, e1, e2), affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e3, e4), affine_map&lt;(e0, e1, e2, e3, e4, e5) -&gt; (e5)] : tensor&lt;?x?x?xf32&gt; into tensor&lt;?x?x?x?x?x?xf32&gt; %1 = linalg.tensor_reshape b [affine_map&lt;(e0, e1, e2, e3) -&gt; (e0, e1, e2), affine_map&lt;(e0, e1, e2, e3) -&gt; (e3)] : tensor&lt;?x?x?xf32&gt; into tensor&lt;?x?x?x?xf32&gt;</p>
<p>The added reshapes are again expanding patterns, so they will get fused with its producers if possible. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00525">525</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="Matchers_8h_source.html#l00196">mlir::detail::enumerate()</a>, <a class="el" href="LogicalResult_8h_source.html#l00062">mlir::failure()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00321">mlir::AffineMap::getDimPosition()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00295">mlir::AffineMap::getNumDims()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00303">mlir::AffineMap::getNumResults()</a>, <a class="el" href="StructuredOpsUtils_8h_source.html#l00074">mlir::getParallelIteratorTypeName()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00312">mlir::AffineMap::getResults()</a>, and <a class="el" href="LogicalResult_8h_source.html#l00056">mlir::success()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a861d3ebb6418a72a09f11866eec0a1bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a861d3ebb6418a72a09f11866eec0a1bd">&#9670;&nbsp;</a></span>isIndexedOpExpandable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmlir_1_1LogicalResult.html">LogicalResult</a> isIndexedOpExpandable </td>
          <td>(</td>
          <td class="paramtype">LinalgOp&#160;</td>
          <td class="paramname"><em>linalgOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Epanding the body of a linalg operation requires adaptations of the accessed loop indices. </p>
<p>Specifically, access of indices in the original operation need to be replaced with linearizations of indices in the expanded op. That requires the shape of the expanded dimensions to be static (at least all but the most significant). For now check that these are all statically sized. Note that this could be extended to handle dynamic case, but the implementation below uses <code>affine.apply</code> which seems to have issues when the shapes are not static. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00632">632</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2BuiltinTypes_8h_source.html#l00138">mlir::ShapedType::isDynamic()</a>, and <a class="el" href="LogicalResult_8h_source.html#l00056">mlir::success()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a00d2f3438facde5a3175b2af173485f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00d2f3438facde5a3175b2af173485f5">&#9670;&nbsp;</a></span>isTensorReshapeOpFoldableByLinearization()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool isTensorReshapeOpFoldableByLinearization </td>
          <td>(</td>
          <td class="paramtype">TensorReshapeOp&#160;</td>
          <td class="paramname"><em>reshapeOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>useIndexMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>asProducer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Checks if the <code>reshapeOp</code> can be fused with it consumer (if <code>asProducer</code> is true) or its producer (if <code>asProducer</code> is false) given the indexing map at its use. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00412">412</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineMap_8cpp_source.html#l00483">mlir::AffineMap::isPermutation()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a0a99149fc8a29f0530e6acca3f05d3af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a99149fc8a29f0530e6acca3f05d3af">&#9670;&nbsp;</a></span>isUnitDimExpansionOnly()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool isUnitDimExpansionOnly </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; int64_t &gt;&#160;</td>
          <td class="paramname"><em>expandedShape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> &gt;&#160;</td>
          <td class="paramname"><em>reassociation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the reshape operation is only expansion into/collapsing of unit-dimension. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00449">449</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="a39deb48b483c295bb262e04a606b0c91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39deb48b483c295bb262e04a606b0c91">&#9670;&nbsp;</a></span>linearizeCollapsedDims()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> linearizeCollapsedDims </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a>&#160;</td>
          <td class="paramname"><em>sourceMap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; int64_t &gt;&#160;</td>
          <td class="paramname"><em>sourceShape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt; <a class="el" href="classmlir_1_1AffineMap.html">AffineMap</a> &gt;&#160;</td>
          <td class="paramname"><em>reassociationMaps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Linearize the expressions in <code>sourceMap</code> based on the <code>reassociationMaps</code> provided, given the shape of the source tensor that corresponds to the <code>sourceMap</code>. </p>
<p>Note that this implicitly assumes that the tensors dimensions are "row-major" ordered logically.</p>
<p>For example:</p>
<p>%0 = op ... : tensor&lt;?x?x4x5xf32&gt; with output index_map <code>affine_map&lt;(d0, d1, d2, d3) -&gt; (d0, d1, d2, d3)&gt;</code></p>
<p>and reshape: %1 = linalg.tensor_reshape %0 [affine_map&lt;(i, j, k, l) -&gt; (i)&gt;, affine_map&lt;(i, j, k, l) -&gt; (j, k, l)&gt;] : tensor&lt;?x?x4x5xf32&gt; into tensor&lt;?x?xf32&gt;</p>
<p>would be rewritten into: %0 = op ... : tensor&lt;?x?x4x5xf32&gt; with output index_map <code>affine_map&lt;(d0, d1, d2, d3) -&gt; (d0, d1 * 20 + d2 * 5 + d3)&gt;</code> </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00375">375</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="MLIRContext_8cpp_source.html#l00957">mlir::AffineMap::get()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00268">mlir::AffineMap::getContext()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00295">mlir::AffineMap::getNumDims()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00299">mlir::AffineMap::getNumSymbols()</a>, <a class="el" href="IR_2AffineMap_8cpp_source.html#l00312">mlir::AffineMap::getResults()</a>, and <a class="el" href="IR_2BuiltinTypes_8cpp_source.html#l00882">mlir::makeCanonicalStridedLayoutExpr()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
<a id="abc0332a7f24654b05ef9d3401d21bb7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc0332a7f24654b05ef9d3401d21bb7e">&#9670;&nbsp;</a></span>updateExpandedIndexOpRegion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classvoid.html">void</a> updateExpandedIndexOpRegion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmlir_1_1PatternRewriter.html">PatternRewriter</a> &amp;&#160;</td>
          <td class="paramname"><em>rewriter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Location.html">Location</a>&#160;</td>
          <td class="paramname"><em>loc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmlir_1_1Region.html">Region</a> &amp;&#160;</td>
          <td class="paramname"><em>fusedRegion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ExpansionInfo &amp;&#160;</td>
          <td class="paramname"><em>expansionInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update the body of an expanded linalg operation having index semantics. </p>
<p>The indices of the original operation need to be recovered by linearizing the indices of the correspoding dimensions of the expanded operation. For now it is assumed that the shapes of the expanded operation needed for linearization are static. </p>

<p class="definition">Definition at line <a class="el" href="FusionOnTensors_8cpp_source.html#l00760">760</a> of file <a class="el" href="FusionOnTensors_8cpp_source.html">FusionOnTensors.cpp</a>.</p>

<p class="reference">References <a class="el" href="IR_2AffineExpr_8h_source.html#l00321">mlir::bindDims()</a>, <a class="el" href="IR_2Builders_8h_source.html#l00393">mlir::OpBuilder::create()</a>, <a class="el" href="IR_2Region_8h_source.html#l00065">mlir::Region::front()</a>, <a class="el" href="IR_2Builders_8h_source.html#l00053">mlir::Builder::getContext()</a>, <a class="el" href="Block_8h_source.html#l00180">mlir::Block::getOps()</a>, <a class="el" href="IR_2BuiltinTypes_8h_source.html#l00138">mlir::ShapedType::isDynamic()</a>, <a class="el" href="PatternMatch_8cpp_source.html#l00221">mlir::RewriterBase::replaceOp()</a>, and <a class="el" href="IR_2Builders_8h_source.html#l00329">mlir::OpBuilder::setInsertionPointAfter()</a>.</p>

<p class="reference">Referenced by <a class="el" href="FusionOnTensors_8cpp_source.html#l00802">fuseWithReshapeByExpansion()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 30 2021 08:50:54 for MLIR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
